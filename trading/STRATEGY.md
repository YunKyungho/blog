# BTC 선물 트레이딩 전략 v4 - 최종 최적화 완료

## 📊 성과 요약

| 기준 | 목표 | 결과 | 상태 |
|------|------|------|------|
| 거래수 | 300-400회/년 | 828회/년 | ✅ |
| 승률 | 40%+ | 41.1%+ | ✅ |
| 월 수익률 | 40%+ | **43.1%** | ✅ |
| 연 수익률 | 480%+ | **516.6%** | ✅ |
| 최대 DD | 40% 이하 | **37.6%** | ✅ |
| 모든 연도 수익 | YES | **YES** | ✅ |

## 📈 연도별 성과 (2019-2025)

| 연도 | 거래수 | 승률 | 수익률 | 최대 DD |
|------|--------|------|--------|---------|
| 2019 | 760 | 42.9% | 348.4% | 37.6% |
| 2020 | 827 | 44.0% | 726.2% | 26.9% |
| 2021 | 1004 | 41.1% | 191.3% | 35.6% |
| 2022 | 837 | 43.6% | 610.9% | 30.4% |
| 2023 | 659 | 44.0% | 436.5% | 24.2% |
| 2024 | 904 | 43.4% | 641.6% | 32.4% |
| 2025 | 808 | 43.9% | 661.6% | 33.4% |

## 🎯 전략 개요

**풀백 매매 전략 (Pullback Trading)**

추세 방향으로 풀백 후 반전 캔들에서 진입하는 추세 추종 전략.

### 핵심 원리
1. 4H 차트에서 MA50으로 큰 추세 판단
2. 15M 차트에서 풀백 후 반전 캔들 감지
3. 추세 방향으로만 진입 (상승→롱, 하락→숏)
4. 고정 SL/TP로 감정 제거

## ⚙️ 최적 파라미터

```python
STRATEGY_PARAMS = {
    'leverage': 12,           # 레버리지
    'risk_per_trade': 2.0,    # 거래당 리스크 %
    'trend_ma': 50,           # 추세 판단 MA (4H)
    'pullback_pct': 0.15,     # 최소 풀백 %
    'max_pullback_pct': 3.0,  # 최대 풀백 %
    'min_body_ratio': 0.5,    # 캔들 바디 비율
    'sl_pct': 0.5,            # 손절 %
    'tp_pct': 0.8,            # 익절 % (1.6:1 손익비)
    'cooldown_minutes': 15,   # 쿨다운
    'volume_mult': 1.0        # 거래량 필터
}
```

## 📋 진입 조건

### 롱 (상승 추세)
1. 4H 가격 > MA50 × 1.005 (상승 추세)
2. 15M 이전 캔들: 음봉
3. 15M 현재 캔들: 양봉 (반전)
4. 최근 10봉 고점 대비 풀백: 0.15% ~ 3%
5. 캔들 바디 비율 ≥ 50%
6. 거래량 ≥ 20봉 평균

### 숏 (하락 추세)
1. 4H 가격 < MA50 × 0.995 (하락 추세)
2. 15M 이전 캔들: 양봉
3. 15M 현재 캔들: 음봉 (반전)
4. 최근 10봉 저점 대비 반등: 0.15% ~ 3%
5. 캔들 바디 비율 ≥ 50%
6. 거래량 ≥ 20봉 평균

## 🛡️ 리스크 관리

### 포지션 사이징
- 거래당 리스크: 잔고의 2%
- 최대 레버리지: 12x
- 포지션 크기 = (잔고 × 리스크%) / SL거리

### 손익비
- SL: 0.5% (진입가 기준)
- TP: 0.8% (진입가 기준)
- 손익비: 1:1.6

### 쿨다운
- 진입 후 15분 대기
- 연속 손실 방지

## 💰 자금 관리

### 운용 구조
- 목표 운용금: $5,000 고정
- 수익 시: 초과분 Spot으로 이체
- 손실 시: Spot에서 충당

### 복리 효과
- 매일 청산 후 리밸런싱
- 단리 구조로 안정성 확보
- 초과 수익은 안전하게 보관

## 📁 파일 구조

```
trading/
├── backtest_db.py      # 백테스트 코드
├── trading_daemon.py   # 실시간 트레이딩 데몬
├── secrets.json        # API 키 (git ignore)
├── config.json         # 설정
├── STRATEGY.md         # 이 문서
└── backtest_yearly_result.json  # 백테스트 결과
```

## 🚀 실행 방법

### 백테스트
```bash
cd ~/.openclaw/workspace/trading
python3 backtest_db.py yearly  # 연도별
python3 backtest_db.py         # 전체
```

### 실시간 트레이딩
```bash
python3 trading_daemon.py
```

## ⚠️ 주의사항

1. **백테스트 ≠ 실제 수익**: 슬리피지, 수수료 미반영
2. **자금 관리 필수**: 감당 가능한 금액만 투자
3. **모니터링**: 정기적으로 성과 확인
4. **시장 변화**: 전략이 안 맞으면 중단

## 📝 최적화 히스토리

### v1 (원본)
- 오더블록 + 클러스터 전략
- 문제: 2019-2021 손실 (-75%~-91%)

### v2
- 이중 MA 추세 필터 추가
- 문제: 여전히 일부 연도 손실

### v3
- 풀백 매매로 전환
- 개선: 모든 연도 수익, DD 40% 이하

### v4 (최종)
- 파라미터 미세 조정
- 레버리지 12x, SL 0.5%, TP 0.8%
- **모든 목표 달성!**

---

*마지막 업데이트: 2025-01*
